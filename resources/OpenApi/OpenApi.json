{
    "openapi": "3.1.0",
    "info": {
        "title": "webtrees API",
        "version": "1.0.0-alpha.2"
    },
    "servers": [
        {
            "url": "https://127.0.0.1/webtrees/api",
            "description": "webtrees server"
        }
    ],
    "paths": {
        "/add-child-to-family": {
            "post": {
                "tags": [
                    "webtrees"
                ],
                "description": "Add a new INDI record for a child to a family.",
                "operationId": "a3433080813fc38f4e1fe7fa29eb970e",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/tree"
                    },
                    {
                        "name": "xref",
                        "in": "query",
                        "description": "The XREF (i.e. GEDOM cross-reference identifier) of the family, to which the child shall be added.",
                        "required": true,
                        "schema": {
                            "$ref": "#/components/schemas/Xref"
                        }
                    },
                    {
                        "$ref": "#/components/parameters/gedcom"
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Added record successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/XrefItem"
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/cli-command": {
            "post": {
                "tags": [
                    "webtrees"
                ],
                "description": "Execute a command on the webtrees command line interface (CLI).",
                "operationId": "29086c632f43178aa7d348ec64bf3dde",
                "parameters": [
                    {
                        "name": "command",
                        "in": "query",
                        "description": "The command to be executed by the command line interface.",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "maxLength": 8096,
                            "example": "config-ini --rewrite-urls"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "The result of a command line execution.",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CliConsoleOutput"
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/create-unlinked-record": {
            "post": {
                "tags": [
                    "webtrees"
                ],
                "description": "Create a GEDCOM record in webtrees, which is not linked to any other record",
                "operationId": "9be6caa7c5f9017551b773cab11de667",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/tree"
                    },
                    {
                        "name": "record-type",
                        "in": "query",
                        "description": "The type of the GEDCOM record to create.",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "maxLength": 4,
                            "pattern": "^[_A-Z][_A-Z0-9]*$",
                            "enum": [
                                "FAM",
                                "INDI",
                                "OBJE",
                                "NOTE",
                                "REPO",
                                "SOUR",
                                "SUBM"
                            ],
                            "example": "INDI"
                        }
                    },
                    {
                        "$ref": "#/components/parameters/gedcom"
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/XrefItem"
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/gedcom-data": {
            "get": {
                "tags": [
                    "webtrees"
                ],
                "description": "Retrieve the GEDCOM data for a record in webtrees.",
                "operationId": "8dfda714183597605f66acc9d5e6e9d6",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/tree"
                    },
                    {
                        "name": "xref",
                        "in": "query",
                        "description": "The XREF (i.e. GEDOM cross-reference identifier) of the record to retrieve.",
                        "required": true,
                        "schema": {
                            "$ref": "#/components/schemas/Xref"
                        }
                    },
                    {
                        "name": "format",
                        "in": "query",
                        "description": "The format of the output. Possible values are \"gedcom\" (GEDCOM 5.5.1), \"gedcom-x\" (default; a JSON GEDCOM format defined by Familysearch), and \"json\" (identical to gedcom-x).",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "default": "gedcom-x",
                            "enum": [
                                "gedcom",
                                "gedcom-x",
                                "json"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "The GEDCOM data of a record in webtrees",
                        "content": {
                            "application/text": {
                                "schema": {
                                    "description": "The GEDCOM 5.5.1 data of a record in webtrees",
                                    "type": "string",
                                    "example": "0 @X1234@ INDI\n1 NAME John /Doe/\n1 BIRT\n2 DATE 19 FEB 1870\n"
                                }
                            },
                            "application/json": {
                                "schema": {
                                    "description": "The GEDCOM-X data of a record in webtrees",
                                    "type": "object"
                                },
                                "example": {
                                    "persons": [
                                        {
                                            "id": "X1234",
                                            "names": [
                                                {
                                                    "nameForms": [
                                                        {
                                                            "fullText": "John Doe"
                                                        }
                                                    ]
                                                }
                                            ],
                                            "facts": [
                                                {
                                                    "type": "http://gedcomx.org/Birth",
                                                    "date": {
                                                        "original": "19 FEB 1870"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    "400": {
                        "$ref": "#/components/responses/400",
                        "description": "Invalid format parameter."
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "404": {
                        "$ref": "#/components/responses/404",
                        "description": "Not found: Tree does not exist, or no matching GEDCOM record found for XREF."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/search-general": {
            "get": {
                "tags": [
                    "webtrees"
                ],
                "description": "Perform a general search in webtrees.",
                "operationId": "8da2970376403615ebe4b6916c648ba7",
                "parameters": [
                    {
                        "name": "tree",
                        "in": "query",
                        "description": "The name of the tree. If not provided, all trees will be searched.",
                        "required": false,
                        "schema": {
                            "$ref": "#/components/schemas/Tree"
                        }
                    },
                    {
                        "name": "query",
                        "in": "query",
                        "description": "The search query.",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "maxLength": 8192
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "The result of a general search in webtrees. The result contains a list of records, each with the tree name and the XREF of the record.",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "required": [
                                        "records"
                                    ],
                                    "properties": {
                                        "records": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/WebtreesSearchResultItem"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "$ref": "#/components/responses/400",
                        "description": "Invalid tree or query parameter."
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "404": {
                        "$ref": "#/components/responses/404",
                        "description": "Not found: Tree does not exist."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/trees": {
            "get": {
                "tags": [
                    "webtrees"
                ],
                "description": "Get a list of the available trees.",
                "operationId": "a5ec69f29847e4994462caba009a57fa",
                "responses": {
                    "200": {
                        "description": "A list of the available trees",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "required": [
                                        "trees"
                                    ],
                                    "properties": {
                                        "trees": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/TreeItem"
                                            }
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/version": {
            "get": {
                "tags": [
                    "webtrees"
                ],
                "description": "Get the webtrees version.",
                "operationId": "933f892564f46241fb22542d565683cd",
                "responses": {
                    "200": {
                        "description": "The webtrees version used",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/WebtreesVersionItem"
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/401",
                        "description": "Unauthorized: Missing authorization header or bearer token."
                    },
                    "403": {
                        "$ref": "#/components/responses/403",
                        "description": "Unauthorized: Insufficient permissions."
                    },
                    "406": {
                        "$ref": "#/components/responses/406",
                        "description": "Not acceptable"
                    },
                    "429": {
                        "$ref": "#/components/responses/429",
                        "description": "Too many requests"
                    },
                    "500": {
                        "$ref": "#/components/responses/429",
                        "description": "Internal server error"
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "CliConsoleOutput": {
                "title": "CliCommandOutput",
                "description": "The output of a command line execution.",
                "properties": {
                    "error": {
                        "description": "Whether an error occurred during the execution of the command.",
                        "type": "boolean"
                    },
                    "exit_code": {
                        "description": "The exit code returned from the command line execution.",
                        "type": "integer"
                    },
                    "console_output": {
                        "description": "The console output returned from the command line execution.",
                        "type": "string"
                    }
                },
                "type": "object",
                "additionalProperties": false
            },
            "Gedcom": {
                "title": "GEDCOM",
                "description": "Schema for GEDCOM data",
                "type": "string",
                "default": "",
                "example": "1 NOTE A record created by the webtrees API.\n1 NOTE Read description about line breaks."
            },
            "Tree": {
                "title": "tree",
                "description": "A webtrees tree",
                "type": "string",
                "maxLength": 1024,
                "pattern": "^[^<>:\\\"\\/\\|?*\\r\\n]+$",
                "example": "mytree",
                "additionalProperties": false
            },
            "TreeItem": {
                "title": "TreeItem",
                "description": "A tree item with id, name, title, media directory, and imported status",
                "properties": {
                    "id": {
                        "description": "The ID of the tree",
                        "type": "integer"
                    },
                    "name": {
                        "description": "The name of the tree",
                        "type": "string",
                        "maxLength": 1024,
                        "pattern": "^[^<>:\"/\\|?*\r\n]+$",
                        "example": "mytree"
                    },
                    "title": {
                        "description": "The title of the tree",
                        "type": "string",
                        "maxLength": 1024,
                        "example": "My Family Tree"
                    },
                    "media_directory": {
                        "description": "The media directory of the tree",
                        "type": "string",
                        "maxLength": 1024,
                        "example": "media/"
                    },
                    "imported": {
                        "description": "Whether the tree has already been imported",
                        "type": "string",
                        "example": "yes"
                    }
                },
                "type": "object",
                "additionalProperties": false
            },
            "WebtreesSearchResultItem": {
                "title": "WebtreesSearchResultItem",
                "description": "Search result item with tree name and xref",
                "properties": {
                    "tree": {
                        "$ref": "#/components/schemas/Tree",
                        "description": "The name of the tree, to which the record belongs"
                    },
                    "xref": {
                        "$ref": "#/components/schemas/Xref",
                        "description": "The XREF (i.e. GEDOM cross-reference identifier) of the record"
                    }
                },
                "type": "object",
                "additionalProperties": false
            },
            "WebtreesVersionItem": {
                "title": "WebtreesVersionItem",
                "description": "webtrees version",
                "properties": {
                    "version": {
                        "description": "webtrees version",
                        "type": "string",
                        "maxLength": 100,
                        "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?(-[A-Za-z0-9]+)?$",
                        "example": "1.2.3"
                    }
                },
                "type": "object",
                "additionalProperties": false
            },
            "Xref": {
                "title": "XREF",
                "description": "A GEDCOM XREF (cross-reference identifier)",
                "type": "string",
                "maxLength": 20,
                "pattern": "^[A-Za-z0-9:_.-]{1,20}$",
                "example": "X1234"
            },
            "XrefItem": {
                "title": "XREF item",
                "description": "A GEDCOM XREF (cross-reference identifier)",
                "properties": {
                    "xref": {
                        "$ref": "#/components/schemas/Xref"
                    }
                },
                "type": "object",
                "additionalProperties": false
            }
        },
        "responses": {
            "400": {
                "description": "400 Bad request"
            },
            "401": {
                "description": "401 Unauthorized"
            },
            "403": {
                "description": "403 Forbidden"
            },
            "404": {
                "description": "404 Not found"
            },
            "405": {
                "description": "405 Method Not Allowed"
            },
            "406": {
                "description": "406 Not acceptable"
            },
            "429": {
                "description": "429 Too many requests"
            },
            "500": {
                "description": "500 Internal server error"
            }
        },
        "parameters": {
            "gedcom": {
                "name": "gedcom",
                "in": "query",
                "description": "The GEDCOM text, which shall be added to the newly created record. The GEDCOM text must not contain a level 0 line, because it is created automatically. \"\\n\" or \"%OA\" will be detected as line break.",
                "required": false,
                "schema": {
                    "$ref": "#/components/schemas/Gedcom"
                }
            },
            "tree": {
                "name": "tree",
                "in": "query",
                "description": "The name of the tree.",
                "required": true,
                "schema": {
                    "$ref": "#/components/schemas/Tree"
                }
            }
        },
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "description": "Basic Auth",
                "scheme": "bearer"
            }
        }
    },
    "security": [
        {
            "bearerAuth": []
        }
    ],
    "tags": [
        {
            "name": "webtrees",
            "description": "webtrees API"
        }
    ]
}