{
  "name": "webtrees-GEDBAS Chat",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "authentication": "basicAuth",
        "initialMessages": "Hi there! ðŸ‘‹\nI am an assistant to compare genealogical data between webtrees and GEDBAS. How can I assist you today?",
        "options": {
          "loadPreviousSession": "memory",
          "subtitle": "An assistant to compare genealogical data between webtrees and GEDBAS",
          "title": "webtrees/GEDBAS chat"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -416,
        64
      ],
      "id": "6db97a19-c8ae-4026-aef8-249907fc1b01",
      "name": "When chat message received",
      "webhookId": "0a626cf5-b9e7-463d-83b5-8532874afffb",
      "credentials": {
        "httpBasicAuth": {
          "id": "qK1zqLcqxIS8HXWO",
          "name": "webtrees Chat ki-test Server"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -16,
        496
      ],
      "id": "62d60b9a-26f8-4723-a6dd-97d5ea71cf34",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "bKqSDQdKNa6bHJZO",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://hemprich.genonline.de/mcp",
        "authentication": "bearerAuth",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        256,
        496
      ],
      "id": "8d696430-27ce-442c-af4e-d78dd411a26a",
      "name": "webtrees MCP Client",
      "credentials": {
        "httpBearerAuth": {
          "id": "mhNfaT0VjO06DcNU",
          "name": "MCP webtrees GenOnline"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        112,
        496
      ],
      "id": "b269c971-6db5-424f-9a24-1ae00fecb7f4",
      "name": "webtrees Chat Memory"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -352,
        288
      ],
      "id": "24b367fe-0c03-4c4e-bafa-fba261d274da",
      "name": "Genealogic Chat Memory"
    },
    {
      "parameters": {
        "toolDescription": "+ Offer to receive textual queries for webtrees.\n+ Receive a query from a genealogical agent.\n+ Retrieve the list of available MCP tools from webtrees. \n+ Analyze and convert the query text into webtrees MCP tool calls.\n+ Use webtrees MCP tools as much as possible.\n+ Read or write genealogical data from or to webtrees with the identified MCP tools.\n+ Answer the incoming query with the data retrieved from webtrees.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "+ You are a helpful assistant for genealogy data.\n+ You can use the MCP tools of the genealogical tool webtrees, to retrieve genealogical data.\n+ The genealogical data is based on the GEDCOM and GEDCOM-X standard.\n+ For queries regarding general historical facts and events, you should not query the MCP tools, but rather use other internet sources.\n+ To handle a request, you can take the following steps:\n    + Get the version of the webtrees tool.\n    + Get a list of genealogical trees, which are available in the webtrees tool.\n    + Search genealogical trees:\n        + If you know the genealogical tree, you can provide it as a parameter to the search.\n        + If you do not know the tree, you can search all trees by using an empty tree parameter.\n        + In order to search, provide keywords in the query string.\n        + You should not use full sentences for query searches; only use keywords.\n        + Keywords could be full names, surnames, first names, places, or dates.\n        + The result of a search is provided as a list with trees and XREF identifyers.\n            + Trees refer to the genealogical trees in webtrees\n            + XREF identifyers refer to genealogical records\n    + Based on a tree and a XREF, the GEDCOM data of records can be retrieved from webtrees\n    + Records contain one of the following objects:\n        + Individual\n        + Family\n        + Media object\n        + Source\n        + Note\n        + Place\n    + Records data contain the following:\n        + Facts and events of an individual, a family, or of other records.\n        + Relationships between individuals or between individuals and families.\n        + References to other records.\n    + If you need to retrieve facts and events in a search, you can take the following steps:\n        + Run a general search in order to search for keywords.\n        + As a result of the general search, you will receive a list of trees and XREF identifyers.\n        + Get the GEDCOM data for each tree and XREF.\n        + Analyse the GEDCOM data for specific facts and events.\n        + Run as many steps as possible before prompting the user.\n    + If you need to modify or add webtrees data, you must take the following steps:\n        + Retrieve the current webtrees data with the MCP tool \"get-record\". Get the record in the GEDCOM format, which is compliant to the GEDCOM 5.5.1 standard,\n        + Add any new data to the record by modifying the GEDCOM data of the record.\n        + Keep as many of the existing GEDCOM data as possible. Only add additional data or modify existing data. Never delete any existing data if not necessary.\n        + Stricly use the GEDCOM 5.5.1 standard for the data structure. \n        + It is mandatory that the resulting text after adding or modifying data is fully compliant to the GEDCOM 5.5.1 standard. \n        + Upload the data to webtrees with the MCP tool \"modify-record\"."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        16,
        288
      ],
      "id": "bbed404b-8e92-4175-b8be-410fe903c156",
      "name": "webtrees AI Agent Tool"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "+ You are a helpful assistant to compare genealogic data between the tools webtrees and the GEDBAS genealogy database.\n+ For genealogical user queries and data, always use the following genealogical AI agents:\n    + webtrees AI agent\n    + GEDBAS AI agent\n+ The webtrees AI agent and GEDBAS AI agent offer textual queries.\n+ Analyse the user request regardings parts, which are relevant for webtrees and GEDBAS.\n+ From the analysis, create textual queries and send the queries to webtrees and GEDBAS. \n+ By querying the genealogical AI agents, you can retrieve and store genealogical data.\n+ The genealogical data is based on the GEDCOM and GEDCOM-X standard.\n+ Compare and diff the data, which is returned from the queries to webtrees and GEDBAS.\n+ Add additional data. Stricly use the GEDCOM-X or the GEDCOM 5.5.1 standard for the data structure.\n+ Answer user requests based on the comparison and diff results.\n+ To handle user requests, you can take the following steps:\n    + Analyze the user requests about parts, which are relevant for webtrees or GEDBAS, or both.\n    + Create and forward queries to the webtrees AI agent.\n    + Query the webtrees AI agent first before querying the GEDBAS AI agent.\n    + Use data retrieved from webtrees to enhance queries for the GEDBAS AI agent. For example, you might use additional data to search for place names.\n    + Create and forward queries to the GEDBAS AI agent.\n    + Use general web based information about the GEDCOM-X and the GEDCOM 5.5.1 standard.\n    + Compare data between webtrees and GEDBAS.\n    + Search webtrees or GEDBAS based on keywords from the user request.\n        + Retrieve data from webtrees and GEDBAS based on the instructions above.\n        + Compare the data received from webtrees and GEDBAS.\n    + Query the webtees AI agent to add additional data in webtrees or to modify existing webtrees data."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -64,
        64
      ],
      "id": "5dafb710-db72-445a-a557-7449ecf6e4e6",
      "name": "Compare AI Agent"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        384,
        496
      ],
      "id": "1c58560a-1792-49a6-bb04-3fc34f4ebf9a",
      "name": "GEDBAS Chat Memory"
    },
    {
      "parameters": {
        "endpointUrl": "https://hemprich.genonline.de/gedbas/mcp",
        "authentication": "bearerAuth",
        "include": "selected",
        "includeTools": [
          "get-person-data",
          "search-simple"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        512,
        496
      ],
      "id": "fbaba242-af5e-475a-a863-8a4f25eb8b3a",
      "name": "GEDBAS simple search MCP Client",
      "credentials": {
        "httpBearerAuth": {
          "id": "mhNfaT0VjO06DcNU",
          "name": "MCP webtrees GenOnline"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Offer to receive textual queries for Gramps.\nReceive a query from a genealogical agent.\nRetrieve the list of available MCP tools from Gramps. \nAnalyze and convert the query text into Gramps MCP tool calls.\nUse Gramps MCP tools as much as possible.\nRead or write genealogical data from or to Gramps with the identified MCP tools.\nAnswer the incoming query with the data retrieved from Gramps.",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "+ You are a helpful assistant for genealogy data.\n+ Your main task is to use the MCP tools of the genealogical database \"GEDBAS\" to retrieve genealogical data for persons.\n+ For queries regarding general historical facts and events, you should not query the MCP tools, but rather use other internet sources.\n+ To handle a request, you can take the following steps:\n\t+ Search the \"lastname\" and \"firstname\" of a person at a certain \"placename\". \n\t+ The search format allows to use the following query parameters:\n\t\t+ firstname\n\t\t+ lastname\n\t\t+ placename\n\t+ As a result of a search, a list of person IDs will be returned.\n\t+ To answer queries about a person, retrieve the genealogical data for a person based on a person ID.\n\t+ The data for a person has the following structure:\n\t\t```json\n\t\t\"schema\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"characteristics\": {\n\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"$ref\": \"#/components/schemas/person_property\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"events\": {\n\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"$ref\": \"#/components/schemas/person_property\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"parents\": {\n\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"$ref\": \"#/components/schemas/parent\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"families\": {\n\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\"$ref\": \"#/components/schemas/family\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t```\n\t+ The genealogical data for a person's characteristics and events has the following JSON format:\n\t\t```json\n\t\t\"person_property\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"Type\": {\n\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t},\n\t\t\t\t\"Value\": {\n\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t},\n\t\t\t\t\"Date\": {\n\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t},\n\t\t\t\t\"Place\": {\n\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t```\n\t+ To get more information about the genealogical data of a person, check the \"Type\" of a person_property. For example, the \"Type\" might be one of the following: \"name\", \"religion\", \"birth\", \"death\", \"burial\".\n\t+ For example, you can get information about the birthdate, if you search for a person_property with type \"birth\" and evaluate the \"date\"."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        336,
        288
      ],
      "id": "122b9ebc-8069-4d95-8b7b-a994313e5ad7",
      "name": "GEDBAS AI Agent Tool"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Compare AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Compare AI Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "webtrees AI Agent Tool",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "GEDBAS AI Agent Tool",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "webtrees MCP Client": {
      "ai_tool": [
        [
          {
            "node": "webtrees AI Agent Tool",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "webtrees Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "webtrees AI Agent Tool",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Genealogic Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Compare AI Agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "When chat message received",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "webtrees AI Agent Tool": {
      "ai_tool": [
        [
          {
            "node": "Compare AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GEDBAS Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "GEDBAS AI Agent Tool",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "GEDBAS simple search MCP Client": {
      "ai_tool": [
        [
          {
            "node": "GEDBAS AI Agent Tool",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GEDBAS AI Agent Tool": {
      "ai_tool": [
        [
          {
            "node": "Compare AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5d8c318b-fde9-4c30-b9ee-e07f1abf4922",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "66abb3d2db824f44fe41528a30fd16f6c1b9736bec8b84a5695b5b0373985e94"
  },
  "id": "YRM3ifCGvoV0JbQd",
  "tags": []
}